\doxysection{hci.\+h}
\hypertarget{hci_8h_source}{}\label{hci_8h_source}\index{powerblocks/core/bluetooth/hci.h@{powerblocks/core/bluetooth/hci.h}}
\mbox{\hyperlink{hci_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <stdbool.h>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <stddef.h>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}FreeRTOS.h"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}semphr.h"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{system_8h}{powerblocks/core/system/system.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ios_8h}{powerblocks/core/ios/ios.h}}"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00028\ \ \ \ \ uint8\_t\ address[6];}
\DoxyCodeLine{00029\ \ \ \ \ uint8\_t\ page\_scan\_repetition\_mode;}
\DoxyCodeLine{00030\ \ \ \ \ uint32\_t\ class\_of\_device;}
\DoxyCodeLine{00031\ \ \ \ \ uint16\_t\ clock\_offset;}
\DoxyCodeLine{00032\ \}\ \mbox{\hyperlink{structhci__discovered__device__info__t}{hci\_discovered\_device\_info\_t}};}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00035\ \ \ \ \ uint16\_t\ acl\_data\_packet\_length;}
\DoxyCodeLine{00036\ \ \ \ \ uint8\_t\ synchronous\_data\_packet\_length;}
\DoxyCodeLine{00037\ \ \ \ \ uint16\_t\ total\_num\_acl\_data\_packets;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Total\ ACL\ packets\ the\ hardware\ can\ store.}}
\DoxyCodeLine{00038\ \ \ \ \ uint16\_t\ total\_num\_synchronous\_data\_packets;\ \textcolor{comment}{//\ Total\ Sync\ packets\ the\ hardware\ can\ store.}}
\DoxyCodeLine{00039\ \}\ \mbox{\hyperlink{structhci__buffer__sizes__t}{hci\_buffer\_sizes\_t}};}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{comment}{//\ Tired\ of\ coding}}
\DoxyCodeLine{00043\ \textcolor{comment}{//\ Felt\ like\ being\ evil\ with\ these\ names}}
\DoxyCodeLine{00044\ \textcolor{comment}{//\ Feel\ free\ to\ refactor.\ I\ am\ sorry}}
\DoxyCodeLine{00045\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00046\ \ \ \ \ HCI\_ACL\_PACKET\_BOUNDARY\_FLAG\_FIRST\_NON\_AUTOMATICALLY\_FLUSHABLE\_PACKET,}
\DoxyCodeLine{00047\ \ \ \ \ HCI\_ACL\_PACKET\_BOUNDARY\_FLAG\_CONTINUING\_FRAGMENT,}
\DoxyCodeLine{00048\ \ \ \ \ HCI\_ACL\_PACKET\_BOUNDARY\_FLAG\_FIRST\_AUTOMATICALLY\_FLUSHABLE\_PACKET}
\DoxyCodeLine{00049\ \}\ hci\_acl\_packet\_boundary\_flag\_t;}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00052\ \ \ \ \ HCI\_ACL\_PACKET\_BROADCAST\_FLAG\_PTP,}
\DoxyCodeLine{00053\ \ \ \ \ HCI\_ACL\_PACKET\_BROADCAST\_FLAG\_ACTIVE\_DEVICE,}
\DoxyCodeLine{00054\ \ \ \ \ HCI\_ACL\_PACKET\_BROADCAST\_FLAG\_PARKED\_DEVICE,}
\DoxyCodeLine{00055\ \}\ hci\_acl\_packet\_broadcast\_flag\_t;}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \textcolor{comment}{//\ HCI\ Defines\ multiple\ inquiry\ modes.\ We\ will\ probably\ ever\ use\ one.}}
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\#define\ HCI\_INQUIRY\_MODE\_GENERAL\_ACCESS\ 0x9E8B33}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{comment}{//\ Max\ size\ of\ a\ name\ from\ name\ request}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#define\ HCI\_MAX\_NAME\_REQUEST\_LENGTH\ 254}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{comment}{//\ Max\ size\ of\ a\ ACL\ data\ section}}
\DoxyCodeLine{00064\ \textcolor{comment}{//\ This\ must\ be\ at\ least\ greater\ than\ the\ max\ size}}
\DoxyCodeLine{00065\ \textcolor{comment}{//\ Reported\ by\ the\ hardware.\ On\ the\ wii\ it\ reports\ 339\ bytes.}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#define\ HCI\_MAX\_ACL\_DATA\_LENGTH\ 512}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{comment}{//\ Defines\ the\ amount\ of\ data\ on\ the\ stack\ needed\ for\ the\ ACL\ receive,\ used\ to\ be\ kept\ around\ for\ async}}
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#define\ HCI\_ACL\_RECEIVE\_IPC\_BUFFER\_SIZE\ (32\ +\ 32\ +\ 32\ +\ 32\ +\ sizeof(ipc\_message))}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00072\ \ \ \ \ uint16\_t\ handle;}
\DoxyCodeLine{00073\ \ \ \ \ uint16\_t\ size;}
\DoxyCodeLine{00074\ \ \ \ \ uint8\_t\ data[HCI\_MAX\_ACL\_DATA\_LENGTH];}
\DoxyCodeLine{00075\ \}\ \mbox{\hyperlink{structhci__acl__packet__t}{hci\_acl\_packet\_t}};}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \textcolor{comment}{//\ Exposed\ HCI\ Buffer\ Sizes}}
\DoxyCodeLine{00078\ \textcolor{comment}{//\ These\ are\ read\ from\ the\ controller\ when\ HCI\ is\ initialized.}}
\DoxyCodeLine{00079\ \textcolor{comment}{//\ Used\ for\ knowing\ how\ big\ and\ how\ many\ ACL/SCL\ buffers\ you\ can\ send}}
\DoxyCodeLine{00080\ \textcolor{keyword}{extern}\ \mbox{\hyperlink{structhci__buffer__sizes__t}{hci\_buffer\_sizes\_t}}\ hci\_buffer\_sizes;}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00089\ \textcolor{keyword}{typedef}\ void\ (*\mbox{\hyperlink{hci_8h_ad272cc1225ecc42e0df1a85037ae8512}{hci\_discovered\_device\_handler}})(\textcolor{keywordtype}{void}*\ user\_data,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structhci__discovered__device__info__t}{hci\_discovered\_device\_info\_t}}*\ device);}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00097\ \textcolor{keyword}{typedef}\ void\ (*\mbox{\hyperlink{hci_8h_a4d3d95b68d0997c3c937cec5b1eaf960}{hci\_discovery\_complete\_handler}})(\textcolor{keywordtype}{void}*\ user\_data,\ uint8\_t\ error);}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00108\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{hci_8h_a9060d7f439b8630abb1c8b77d910ba25}{hci\_initialize}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ device);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00119\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{hci_8h_a4b16d7840a13fb4b45bf675a6ac467d9}{hci\_close}}();}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00127\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{hci_8h_a03b5e03bc25d2bc2cb6a24397be097c3}{hci\_reset}}();}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00154\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{hci_8h_a32b40898ca4e5f0fa9e74632e1ade5c7}{hci\_begin\_discovery}}(}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ uint32\_t\ lap,\ uint8\_t\ length,\ uint8\_t\ responses,}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{hci_8h_ad272cc1225ecc42e0df1a85037ae8512}{hci\_discovered\_device\_handler}}\ on\_discovered,\ \mbox{\hyperlink{hci_8h_a4d3d95b68d0997c3c937cec5b1eaf960}{hci\_discovery\_complete\_handler}}\ on\_complete,\ \textcolor{keywordtype}{void}\ *user\_data);}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00166\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{hci_8h_a553ec0ac78516890131a5986d5ae2a9d}{hci\_cancel\_discovery}}();}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00181\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{hci_8h_aa306fd34fe4e74c3bf54b10403c088c6}{hci\_get\_remote\_name}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structhci__discovered__device__info__t}{hci\_discovered\_device\_info\_t}}*\ device,\ uint8\_t*\ name);}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00191\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{hci_8h_a64bb7fcb5fa4620ab6d7ae44815f6859}{hci\_create\_connection}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structhci__discovered__device__info__t}{hci\_discovered\_device\_info\_t}}*\ device,\ uint16\_t*\ handle);}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \textcolor{comment}{//\ These\ 2\ buffers\ have\ been\ statically\ allocated\ so\ that}}
\DoxyCodeLine{00194\ \textcolor{comment}{//\ You\ can\ lower\ the\ amount\ of\ memcpys\ in\ ACL\ transactions}}
\DoxyCodeLine{00195\ \textcolor{keyword}{extern}\ SemaphoreHandle\_t\ hcl\_acl\_packet\_out\_lock;}
\DoxyCodeLine{00196\ \textcolor{keyword}{extern}\ \mbox{\hyperlink{structhci__acl__packet__t}{hci\_acl\_packet\_t}}\ hci\_acl\_packet\_out\ \mbox{\hyperlink{system_8h_abe7f8cd9a0ce69b71567a3870415be66}{ALIGN}}(32)\ MEM2;}
\DoxyCodeLine{00197\ extern\ \mbox{\hyperlink{structhci__acl__packet__t}{hci\_acl\_packet\_t}}\ hci\_acl\_packet\_in\_0\ \mbox{\hyperlink{system_8h_abe7f8cd9a0ce69b71567a3870415be66}{ALIGN}}(32)\ MEM2;}
\DoxyCodeLine{00198\ extern\ \mbox{\hyperlink{structhci__acl__packet__t}{hci\_acl\_packet\_t}}\ hci\_acl\_packet\_in\_1\ \mbox{\hyperlink{system_8h_abe7f8cd9a0ce69b71567a3870415be66}{ALIGN}}(32)\ MEM2;}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00216\ extern\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{hci_8c_a0237e9b843f7a2506862f0cd31f48133}{hci\_send\_acl}}(uint16\_t\ handle,\ hci\_acl\_packet\_boundary\_flag\_t\ pb,\ hci\_acl\_packet\_broadcast\_flag\_t\ bc,\ uint16\_t\ length);}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00238\ extern\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{hci_8c_af3918df454b0d3aef8f99722f056f5f9}{hci\_receive\_acl\_async}}(\mbox{\hyperlink{structhci__acl__packet__t}{hci\_acl\_packet\_t}}*\ acl\_buffer,\ uint8\_t*\ ipc\_buffer,\ ipc\_async\_handler\_t\ handler,\ \textcolor{keywordtype}{void}*\ params);}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00253\ extern\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{hci_8c_ab8356427c489c88d983e3029935b0c0d}{hci\_decode\_received\_acl}}(uint16\_t\ *handle,\ hci\_acl\_packet\_boundary\_flag\_t\ *pb,\ hci\_acl\_packet\_broadcast\_flag\_t\ *bc,\ uint16\_t*\ length,\ const\ \mbox{\hyperlink{structhci__acl__packet__t}{hci\_acl\_packet\_t}}*\ acl\_buffer);}

\end{DoxyCode}
