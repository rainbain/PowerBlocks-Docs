\doxysection{powerblocks/core/bluetooth/hci.c File Reference}
\hypertarget{hci_8c}{}\label{hci_8c}\index{powerblocks/core/bluetooth/hci.c@{powerblocks/core/bluetooth/hci.c}}


Bluetooth HCI Driver.  


{\ttfamily \#include "{}hci.\+h"{}}\newline
{\ttfamily \#include "{}powerblocks/core/system/system.\+h"{}}\newline
{\ttfamily \#include "{}powerblocks/core/ios/ios.\+h"{}}\newline
{\ttfamily \#include "{}powerblocks/core/utils/log.\+h"{}}\newline
{\ttfamily \#include "{}Free\+RTOS.\+h"{}}\newline
{\ttfamily \#include "{}task.\+h"{}}\newline
{\ttfamily \#include "{}semphr.\+h"{}}\newline
{\ttfamily \#include "{}blerror.\+h"{}}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$stdalign.\+h$>$}\newline
{\ttfamily \#include $<$endian.\+h$>$}\newline
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structhci__event}{hci\+\_\+event}}
\item 
struct \mbox{\hyperlink{structhci__local__version__information__t}{hci\+\_\+local\+\_\+version\+\_\+information\+\_\+t}}
\item 
struct \mbox{\hyperlink{structhci__command__request}{hci\+\_\+command\+\_\+request}}
\item 
struct \mbox{\hyperlink{structhci__command__buffer}{hci\+\_\+command\+\_\+buffer}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{hci_8c_a43427c383cd87311ecbf9f8aa87be6e6}\label{hci_8c_a43427c383cd87311ecbf9f8aa87be6e6} 
\#define {\bfseries USB\+\_\+\+ALIGN}~32
\item 
\Hypertarget{hci_8c_af2bbeef798fd0fa4d3abf2cce2aab757}\label{hci_8c_af2bbeef798fd0fa4d3abf2cce2aab757} 
\#define {\bfseries HCI\+\_\+\+TASK\+\_\+\+STACK\+\_\+\+SIZE}~8192
\item 
\Hypertarget{hci_8c_aebce22ac6a87da1779a9e43a11c8b119}\label{hci_8c_aebce22ac6a87da1779a9e43a11c8b119} 
\#define {\bfseries HCI\+\_\+\+TASK\+\_\+\+PRIORITY}~(config\+MAX\+\_\+\+PRIORITIES / 4 \texorpdfstring{$\ast$}{*} 3)
\item 
\Hypertarget{hci_8c_a81d32da4ba1e625acd976abd57d9c223}\label{hci_8c_a81d32da4ba1e625acd976abd57d9c223} 
\#define {\bfseries HCI\+\_\+\+ERROR\+\_\+\+LOGGING}
\item 
\#define \mbox{\hyperlink{hci_8c_a3519d9cccefcc653b8c5ac6a9889c670}{HCI\+\_\+\+LOG\+\_\+\+ERROR}}(tab,  fmt, ...)
\item 
\Hypertarget{hci_8c_a974ab56c6e2d7ba8cf28c9325acc617d}\label{hci_8c_a974ab56c6e2d7ba8cf28c9325acc617d} 
\#define {\bfseries HCI\+\_\+\+LOG\+\_\+\+INFO}(tab,  fmt, ...)
\item 
\Hypertarget{hci_8c_a9b21a653d1d34313f12d56e7627bc7ea}\label{hci_8c_a9b21a653d1d34313f12d56e7627bc7ea} 
\#define {\bfseries HCI\+\_\+\+LOG\+\_\+\+DEBUG}(tab,  fmt, ...)
\item 
\Hypertarget{hci_8c_a9d566e172a2717c6ee1fca7b2dc24371}\label{hci_8c_a9d566e172a2717c6ee1fca7b2dc24371} 
\#define {\bfseries HCI\+\_\+\+MAX\+\_\+\+COMMAND\+\_\+\+DATA\+\_\+\+LENGTH}~64
\item 
\Hypertarget{hci_8c_aad9685e285deabe8763a76df58b652fe}\label{hci_8c_aad9685e285deabe8763a76df58b652fe} 
\#define {\bfseries HCI\+\_\+\+MAX\+\_\+\+EVENT\+\_\+\+LENGTH}~255
\item 
\Hypertarget{hci_8c_a9f7ed3d52c74791691ec21d01b145f40}\label{hci_8c_a9f7ed3d52c74791691ec21d01b145f40} 
\#define {\bfseries HCI\+\_\+\+WAITER\+\_\+\+TIMEOUT}~6000
\item 
\Hypertarget{hci_8c_a2b764f014496024a3009b8d85752f298}\label{hci_8c_a2b764f014496024a3009b8d85752f298} 
\#define {\bfseries HCI\+\_\+\+IOS\+\_\+\+IOCTL\+\_\+\+USB\+\_\+\+CONTROL}~0
\item 
\Hypertarget{hci_8c_adc08a68a7367b22caae481f4fcd3424b}\label{hci_8c_adc08a68a7367b22caae481f4fcd3424b} 
\#define {\bfseries HCI\+\_\+\+IOS\+\_\+\+IOCTL\+\_\+\+USB\+\_\+\+BULK}~1
\item 
\Hypertarget{hci_8c_a68ae30e2a415a63150777d9e986d370c}\label{hci_8c_a68ae30e2a415a63150777d9e986d370c} 
\#define {\bfseries HCI\+\_\+\+IOS\+\_\+\+IOCTL\+\_\+\+USB\+\_\+\+INTERRUPT}~2
\item 
\Hypertarget{hci_8c_aa88cb1d69be74323b5a7a80be14c8075}\label{hci_8c_aa88cb1d69be74323b5a7a80be14c8075} 
\#define {\bfseries HCI\+\_\+\+ENDPOINT\+\_\+\+CONTROL}~0x00
\item 
\Hypertarget{hci_8c_a0b171eddd863064f78d23d3f31eb13bc}\label{hci_8c_a0b171eddd863064f78d23d3f31eb13bc} 
\#define {\bfseries HCI\+\_\+\+ENDPOINT\+\_\+\+ACL\+\_\+\+OUT}~0x02
\item 
\Hypertarget{hci_8c_a5ebdc73f6c0c39a2b57738f82b08d19c}\label{hci_8c_a5ebdc73f6c0c39a2b57738f82b08d19c} 
\#define {\bfseries HCI\+\_\+\+ENDPOINT\+\_\+\+EVENTS}~0x81
\item 
\Hypertarget{hci_8c_acccf13d6bddcb85aacd66ac01f6d4841}\label{hci_8c_acccf13d6bddcb85aacd66ac01f6d4841} 
\#define {\bfseries HCI\+\_\+\+ENDPOINT\+\_\+\+ACL\+\_\+\+IN}~0x82
\item 
\Hypertarget{hci_8c_afbb6b3ae4e7909fb3b26f37ce4837852}\label{hci_8c_afbb6b3ae4e7909fb3b26f37ce4837852} 
\#define {\bfseries HCI\+\_\+\+EVENT\+\_\+\+CODE\+\_\+\+INQUIRY\+\_\+\+COMPLETE}~0x01
\item 
\Hypertarget{hci_8c_a29cce9f4b202073a6ea48d0694be214d}\label{hci_8c_a29cce9f4b202073a6ea48d0694be214d} 
\#define {\bfseries HCI\+\_\+\+EVENT\+\_\+\+CODE\+\_\+\+INQUIRY\+\_\+\+RESULT}~0x02
\item 
\Hypertarget{hci_8c_aba0f1e3e4553d99ac0fe6f2d85284cc0}\label{hci_8c_aba0f1e3e4553d99ac0fe6f2d85284cc0} 
\#define {\bfseries HCI\+\_\+\+EVENT\+\_\+\+CONNECTION\+\_\+\+COMPLETE}~0x03
\item 
\Hypertarget{hci_8c_a076d3e5c68c54f1c1808a34cfd64dc1b}\label{hci_8c_a076d3e5c68c54f1c1808a34cfd64dc1b} 
\#define {\bfseries HCI\+\_\+\+EVENT\+\_\+\+CODE\+\_\+\+REMOTE\+\_\+\+NAME\+\_\+\+REQUEST\+\_\+\+COMPLETE}~0x07
\item 
\Hypertarget{hci_8c_a93be122b873a4ea8c143fe09baab763e}\label{hci_8c_a93be122b873a4ea8c143fe09baab763e} 
\#define {\bfseries HCI\+\_\+\+EVENT\+\_\+\+CODE\+\_\+\+COMMAND\+\_\+\+COMPLETE}~0x0E
\item 
\Hypertarget{hci_8c_af367b32bb775cfe313e6ab8b5e84a668}\label{hci_8c_af367b32bb775cfe313e6ab8b5e84a668} 
\#define {\bfseries HCI\+\_\+\+EVENT\+\_\+\+CODE\+\_\+\+COMMAND\+\_\+\+STATUS}~0x0F
\item 
\Hypertarget{hci_8c_ad9265f8709e448e7bd6f654a8798c37c}\label{hci_8c_ad9265f8709e448e7bd6f654a8798c37c} 
\#define {\bfseries HCI\+\_\+\+EVENT\+\_\+\+HARDWARE\+\_\+\+ERROR}~0x10
\item 
\Hypertarget{hci_8c_a3f62f413a9ea26ddc4eed686bee1f176}\label{hci_8c_a3f62f413a9ea26ddc4eed686bee1f176} 
\#define {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ACL\+\_\+\+NUMBER\+\_\+\+OF\+\_\+\+COMPLETE\+\_\+\+PACKETS}~0x13
\item 
\Hypertarget{hci_8c_a6bae95bc3099237a59dc1992fdf6f2df}\label{hci_8c_a6bae95bc3099237a59dc1992fdf6f2df} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+READ\+\_\+\+LOCAL\+\_\+\+VERSION\+\_\+\+INFORMATION}~0x1001
\item 
\Hypertarget{hci_8c_ab9d5b38685993daae4b5b7c562e32098}\label{hci_8c_ab9d5b38685993daae4b5b7c562e32098} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+READ\+\_\+\+LOCAL\+\_\+\+SUPPORTED\+\_\+\+FEATURES}~0x1003
\item 
\Hypertarget{hci_8c_a21cc0093c2b5dcce68cf9c5e1169d981}\label{hci_8c_a21cc0093c2b5dcce68cf9c5e1169d981} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+READ\+\_\+\+BUFFER\+\_\+\+SIZE}~0x1005
\item 
\Hypertarget{hci_8c_aba87f3de490aed2cd0ea480910e97270}\label{hci_8c_aba87f3de490aed2cd0ea480910e97270} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+READ\+\_\+\+BD\+\_\+\+ADDR}~0x1009
\item 
\Hypertarget{hci_8c_a021a170c0c151c01af750cab5f12e55c}\label{hci_8c_a021a170c0c151c01af750cab5f12e55c} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+INQUIRY\+\_\+\+START}~0x0401
\item 
\Hypertarget{hci_8c_aa7d203c1099ba578d2b0e33f1edd4b1a}\label{hci_8c_aa7d203c1099ba578d2b0e33f1edd4b1a} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+INQUIRY\+\_\+\+CANCEL}~0x0402
\item 
\Hypertarget{hci_8c_aab114ca1ac45bc3e36bfdcea3109519e}\label{hci_8c_aab114ca1ac45bc3e36bfdcea3109519e} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+CREATE\+\_\+\+CONNECTION}~0x0405
\item 
\Hypertarget{hci_8c_a6420cd235ca9116657f0892a2876275b}\label{hci_8c_a6420cd235ca9116657f0892a2876275b} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+REMOTE\+\_\+\+NAME\+\_\+\+REQUEST}~0x0419
\item 
\Hypertarget{hci_8c_a48ce87b68aeeff35c73cd1ce41875a49}\label{hci_8c_a48ce87b68aeeff35c73cd1ce41875a49} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+SET\+\_\+\+EVENT\+\_\+\+MASK}~0x0\+C01
\item 
\Hypertarget{hci_8c_addcdfa80156ea64d9a01063ecd76753c}\label{hci_8c_addcdfa80156ea64d9a01063ecd76753c} 
\#define {\bfseries HCI\+\_\+\+OPCODE\+\_\+\+RESET}~0x0\+C03
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{hci_8c_a75bfb476df9ac49f9c700a3c36ce804f}\label{hci_8c_a75bfb476df9ac49f9c700a3c36ce804f} 
enum {\bfseries hci\+\_\+event\+\_\+id\+\_\+t} \{ \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+INQUIRY\+\_\+\+COMPLETE} = 0
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+INQUIRY\+\_\+\+RESULT} = 1
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+CONNECTION\+\_\+\+COMPLETE} = 2
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+CONNECTION\+\_\+\+REQUEST} = 3
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+DISCONNECTION\+\_\+\+COMPLETE} = 4
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+AUTHENTICATION\+\_\+\+COMPLETE} = 5
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+REMOTE\+\_\+\+NAME\+\_\+\+REQUEST} = 6
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+ENCRYPTION\+\_\+\+CHANGE} = 7
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+CHANGE\+\_\+\+CONNECTION\+\_\+\+LINK\+\_\+\+KEY\+\_\+\+COMPLETE} = 8
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+MASTER\+\_\+\+LINK\+\_\+\+KEY\+\_\+\+COMPLETE} = 9
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+READ\+\_\+\+REMOTE\+\_\+\+SUPPORTED\+\_\+\+FEATURES\+\_\+\+COMPLETE} = 10
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+READ\+\_\+\+REMOTE\+\_\+\+VERSION\+\_\+\+INFORMATION\+\_\+\+COMPLETE} = 11
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+QOS\+\_\+\+SETUP\+\_\+\+COMPLETE} = 12
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+HARDWARE\+\_\+\+ERROR} = 15
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+FLUSH\+\_\+\+OCCURRED} = 16
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+ROLE\+\_\+\+CHANGE} = 17
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+MODE\+\_\+\+CHANGE} = 19
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+RETURN\+\_\+\+LINK\+\_\+\+KEYS} = 20
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+PIN\+\_\+\+CODE\+\_\+\+REQUEST} = 21
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+LINK\+\_\+\+KEY\+\_\+\+REQUEST} = 22
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+LINK\+\_\+\+KEY\+\_\+\+NOTIFICATION} = 23
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+LOOPBACK\+\_\+\+COMMAND} = 24
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+DATA\+\_\+\+BUFFER\+\_\+\+OVERFLOW} = 25
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+MAX\+\_\+\+SLOTS\+\_\+\+CHANGE} = 26
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+READ\+\_\+\+CLOCK\+\_\+\+OFFSET\+\_\+\+COMPLETE} = 27
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+CONNECTION\+\_\+\+PACKET\+\_\+\+TYPE\+\_\+\+CHANGED} = 28
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+QOS\+\_\+\+VIOLATION} = 29
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+PAGE\+\_\+\+SCAN\+\_\+\+MODE\+\_\+\+CHANGE} = 30
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+PAGE\+\_\+\+SCAN\+\_\+\+REPETITION\+\_\+\+MODE\+\_\+\+CHANGE} = 31
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+FLOW\+\_\+\+SPECIFICATION\+\_\+\+COMPLETE} = 32
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+INQUIRY\+\_\+\+RESULT\+\_\+\+WITH\+\_\+\+RSSI} = 33
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+READ\+\_\+\+REMOTE\+\_\+\+EXTENDED\+\_\+\+FEATURES\+\_\+\+COMPLETE} = 34
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+SYNCHRONOUS\+\_\+\+CONNECTION\+\_\+\+COMPLETE} = 43
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+SYNCHRONOUS\+\_\+\+CONNECTED\+\_\+\+CHANGED} = 44
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+SNIFF\+\_\+\+SUBRATING} = 45
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+EXTENDED\+\_\+\+INQUIRY\+\_\+\+RESULT} = 46
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+ENCRYPTION\+\_\+\+KEY\+\_\+\+REFRESH\+\_\+\+COMPLETE} = 47
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+IO\+\_\+\+CAPABILITY\+\_\+\+REQUEST} = 48
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+IO\+\_\+\+CAPABILITY\+\_\+\+REQUEST\+\_\+\+REPLY} = 49
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+USER\+\_\+\+CONFIRMATION\+\_\+\+REQUEST} = 50
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+USER\+\_\+\+PASSKEY\+\_\+\+REQUEST} = 51
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+REMOTE\+\_\+\+OOB\+\_\+\+DATA\+\_\+\+REQUEST} = 52
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+SIMPLE\+\_\+\+PAIRING\+\_\+\+COMPLETE} = 53
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+LINK\+\_\+\+SUPERVISION\+\_\+\+TIMEOUT\+\_\+\+CHANGED} = 55
, \newline
{\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+ENHANCED\+\_\+\+FLUSH\+\_\+\+COMPLETE} = 56
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+USER\+\_\+\+PASSKEY\+\_\+\+NOTIFICATION} = 58
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+KEYPRESS\+\_\+\+NOTIFICATION\+\_\+\+EVENT} = 59
, {\bfseries HCI\+\_\+\+EVENT\+\_\+\+ID\+\_\+\+REMOTE\+\_\+\+HOST\+\_\+\+SUPPORTED\+\_\+\+FEATURES} = 60
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{hci_8c_a9060d7f439b8630abb1c8b77d910ba25}{hci\+\_\+initialize}} (const char \texorpdfstring{$\ast$}{*}device)
\begin{DoxyCompactList}\small\item\em Initializes the HCI interface. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{hci_8c_a4b16d7840a13fb4b45bf675a6ac467d9}{hci\+\_\+close}} ()
\begin{DoxyCompactList}\small\item\em Closes the HCI driver. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{hci_8c_a03b5e03bc25d2bc2cb6a24397be097c3}{hci\+\_\+reset}} ()
\begin{DoxyCompactList}\small\item\em Resets the HCI Interface. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{hci_8c_a32b40898ca4e5f0fa9e74632e1ade5c7}{hci\+\_\+begin\+\_\+discovery}} (uint32\+\_\+t lap, uint8\+\_\+t length, uint8\+\_\+t responses, \mbox{\hyperlink{hci_8h_ad272cc1225ecc42e0df1a85037ae8512}{hci\+\_\+discovered\+\_\+device\+\_\+handler}} on\+\_\+discovered, \mbox{\hyperlink{hci_8h_a4d3d95b68d0997c3c937cec5b1eaf960}{hci\+\_\+discovery\+\_\+complete\+\_\+handler}} on\+\_\+complete, void \texorpdfstring{$\ast$}{*}user\+\_\+data)
\begin{DoxyCompactList}\small\item\em Begins looking for bluetooth devices. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{hci_8c_a553ec0ac78516890131a5986d5ae2a9d}{hci\+\_\+cancel\+\_\+discovery}} ()
\begin{DoxyCompactList}\small\item\em Stops a discovery session. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{hci_8c_aa306fd34fe4e74c3bf54b10403c088c6}{hci\+\_\+get\+\_\+remote\+\_\+name}} (const \mbox{\hyperlink{structhci__discovered__device__info__t}{hci\+\_\+discovered\+\_\+device\+\_\+info\+\_\+t}} \texorpdfstring{$\ast$}{*}device, uint8\+\_\+t \texorpdfstring{$\ast$}{*}name)
\begin{DoxyCompactList}\small\item\em Returns the remote name of a device. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{hci_8c_a64bb7fcb5fa4620ab6d7ae44815f6859}{hci\+\_\+create\+\_\+connection}} (const \mbox{\hyperlink{structhci__discovered__device__info__t}{hci\+\_\+discovered\+\_\+device\+\_\+info\+\_\+t}} \texorpdfstring{$\ast$}{*}device, uint16\+\_\+t \texorpdfstring{$\ast$}{*}handle)
\begin{DoxyCompactList}\small\item\em Creates a connection to a device for you to use. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{hci_8c_a0237e9b843f7a2506862f0cd31f48133}{hci\+\_\+send\+\_\+acl}} (uint16\+\_\+t handle, hci\+\_\+acl\+\_\+packet\+\_\+boundary\+\_\+flag\+\_\+t pb, hci\+\_\+acl\+\_\+packet\+\_\+broadcast\+\_\+flag\+\_\+t bc, uint16\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Sends a ACL Packet. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{hci_8c_af3918df454b0d3aef8f99722f056f5f9}{hci\+\_\+receive\+\_\+acl\+\_\+async}} (\mbox{\hyperlink{structhci__acl__packet__t}{hci\+\_\+acl\+\_\+packet\+\_\+t}} \texorpdfstring{$\ast$}{*}acl\+\_\+buffer, uint8\+\_\+t \texorpdfstring{$\ast$}{*}ipc\+\_\+buffer, ipc\+\_\+async\+\_\+handler\+\_\+t handler, void \texorpdfstring{$\ast$}{*}params)
\begin{DoxyCompactList}\small\item\em Receives a ACL Packet Asynchronously. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{hci_8c_ab8356427c489c88d983e3029935b0c0d}{hci\+\_\+decode\+\_\+received\+\_\+acl}} (uint16\+\_\+t \texorpdfstring{$\ast$}{*}handle, hci\+\_\+acl\+\_\+packet\+\_\+boundary\+\_\+flag\+\_\+t \texorpdfstring{$\ast$}{*}pb, hci\+\_\+acl\+\_\+packet\+\_\+broadcast\+\_\+flag\+\_\+t \texorpdfstring{$\ast$}{*}bc, uint16\+\_\+t \texorpdfstring{$\ast$}{*}length, const \mbox{\hyperlink{structhci__acl__packet__t}{hci\+\_\+acl\+\_\+packet\+\_\+t}} \texorpdfstring{$\ast$}{*}acl\+\_\+buffer)
\begin{DoxyCompactList}\small\item\em Decodes a received ACL packet. \end{DoxyCompactList}\item 
\Hypertarget{hci_8c_a55d27ca8bf1b73b12c39c91629dc8d97}\label{hci_8c_a55d27ca8bf1b73b12c39c91629dc8d97} 
\mbox{\hyperlink{structhci__event}{hci\+\_\+event}} hci\+\_\+event\+\_\+buffer MEM2 {\bfseries ALIGN} (32) = "{}/shared2/sys/SYSCONF"{}
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{hci_8c_a7af504f7cd618ba84395397d47c5754a}\label{hci_8c_a7af504f7cd618ba84395397d47c5754a} 
\mbox{\hyperlink{structhci__buffer__sizes__t}{hci\+\_\+buffer\+\_\+sizes\+\_\+t}} {\bfseries hci\+\_\+buffer\+\_\+sizes}
\item 
\Hypertarget{hci_8c_a1803aef363c3896bc8368c255fe80b37}\label{hci_8c_a1803aef363c3896bc8368c255fe80b37} 
Semaphore\+Handle\+\_\+t {\bfseries hcl\+\_\+acl\+\_\+packet\+\_\+out\+\_\+lock}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Bluetooth HCI Driver. 

This driver talks to USB HCI devices. Those are "{}\+Host Controller Interfaces"{} for communicating with bluetooth devices over USB

This is done as Wiimotes are connected through the Wii\textquotesingle{}s internal bluetooth dongle.

\begin{DoxyAuthor}{Author}
Samuel Fitzsimons (rainbain) 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2025 
\end{DoxyDate}


\doxysubsection{Macro Definition Documentation}
\Hypertarget{hci_8c_a3519d9cccefcc653b8c5ac6a9889c670}\index{hci.c@{hci.c}!HCI\_LOG\_ERROR@{HCI\_LOG\_ERROR}}
\index{HCI\_LOG\_ERROR@{HCI\_LOG\_ERROR}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{HCI\_LOG\_ERROR}{HCI\_LOG\_ERROR}}
{\footnotesize\ttfamily \label{hci_8c_a3519d9cccefcc653b8c5ac6a9889c670} 
\#define HCI\+\_\+\+LOG\+\_\+\+ERROR(\begin{DoxyParamCaption}\item[{}]{tab}{, }\item[{}]{fmt}{, }\item[{}]{}...{}\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{LOG\_ERROR(tab,\ fmt,\ \#\#\_\_VA\_ARGS\_\_)}

\end{DoxyCode}


\doxysubsection{Function Documentation}
\Hypertarget{hci_8c_a32b40898ca4e5f0fa9e74632e1ade5c7}\index{hci.c@{hci.c}!hci\_begin\_discovery@{hci\_begin\_discovery}}
\index{hci\_begin\_discovery@{hci\_begin\_discovery}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_begin\_discovery()}{hci\_begin\_discovery()}}
{\footnotesize\ttfamily \label{hci_8c_a32b40898ca4e5f0fa9e74632e1ade5c7} 
int hci\+\_\+begin\+\_\+discovery (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{lap}{, }\item[{uint8\+\_\+t}]{length}{, }\item[{uint8\+\_\+t}]{responses}{, }\item[{\mbox{\hyperlink{hci_8h_ad272cc1225ecc42e0df1a85037ae8512}{hci\+\_\+discovered\+\_\+device\+\_\+handler}}}]{on\+\_\+discovered}{, }\item[{\mbox{\hyperlink{hci_8h_a4d3d95b68d0997c3c937cec5b1eaf960}{hci\+\_\+discovery\+\_\+complete\+\_\+handler}}}]{on\+\_\+complete}{, }\item[{void \texorpdfstring{$\ast$}{*}}]{user\+\_\+data}{}\end{DoxyParamCaption})}



Begins looking for bluetooth devices. 

Will begin looking for bluetooth devices.

On emulator, dolphin will report wiimote devices 1 at a time.

Only 1 thing can be running discovery at a time. Calling this while a discovery session is already running will return an error.

You generally need to wait for the inquiry to end before doing anything. ACL packets are fine though.

Handlers called from the HCI Task. Please do not call HCI function from the HCI task.


\begin{DoxyParams}{Parameters}
{\em lap} & Access code for what devices to discover. Usually HCI\+\_\+\+INQUIRY\+\_\+\+MODE\+\_\+\+GENERAL\+\_\+\+ACCESS \\
\hline
{\em length} & Time to discover devices for. In units of 1.\+28 seconds. 0x01 â€“ 0x30, Dolphin always completes instantly \\
\hline
{\em responses} & Max devices discovered. Or 0 for infinite up until timeout. \\
\hline
{\em on\+\_\+discovered} & Called when a device is discovered. May be NOT be NULL \\
\hline
{\em on\+\_\+complete} & Called when the discovery session ends. May be NULL \\
\hline
{\em user\+\_\+data} & Pointer passed to handlers. May be NULL.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_a553ec0ac78516890131a5986d5ae2a9d}\index{hci.c@{hci.c}!hci\_cancel\_discovery@{hci\_cancel\_discovery}}
\index{hci\_cancel\_discovery@{hci\_cancel\_discovery}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_cancel\_discovery()}{hci\_cancel\_discovery()}}
{\footnotesize\ttfamily \label{hci_8c_a553ec0ac78516890131a5986d5ae2a9d} 
int hci\+\_\+cancel\+\_\+discovery (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Stops a discovery session. 

Once returns a non error value, no more of the discovery handlers will be called.

\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_a4b16d7840a13fb4b45bf675a6ac467d9}\index{hci.c@{hci.c}!hci\_close@{hci\_close}}
\index{hci\_close@{hci\_close}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_close()}{hci\_close()}}
{\footnotesize\ttfamily \label{hci_8c_a4b16d7840a13fb4b45bf675a6ac467d9} 
void hci\+\_\+close (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Closes the HCI driver. 

Currently, if HCI gets stuck, this function will get stuck waiting for the resource to open up.

\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_a64bb7fcb5fa4620ab6d7ae44815f6859}\index{hci.c@{hci.c}!hci\_create\_connection@{hci\_create\_connection}}
\index{hci\_create\_connection@{hci\_create\_connection}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_create\_connection()}{hci\_create\_connection()}}
{\footnotesize\ttfamily \label{hci_8c_a64bb7fcb5fa4620ab6d7ae44815f6859} 
int hci\+\_\+create\+\_\+connection (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structhci__discovered__device__info__t}{hci\+\_\+discovered\+\_\+device\+\_\+info\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{device}{, }\item[{uint16\+\_\+t \texorpdfstring{$\ast$}{*}}]{handle}{}\end{DoxyParamCaption})}



Creates a connection to a device for you to use. 


\begin{DoxyParams}{Parameters}
{\em device} & Discovered device to connect to \\
\hline
{\em handle} & Device handle out. Not null\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_ab8356427c489c88d983e3029935b0c0d}\index{hci.c@{hci.c}!hci\_decode\_received\_acl@{hci\_decode\_received\_acl}}
\index{hci\_decode\_received\_acl@{hci\_decode\_received\_acl}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_decode\_received\_acl()}{hci\_decode\_received\_acl()}}
{\footnotesize\ttfamily \label{hci_8c_ab8356427c489c88d983e3029935b0c0d} 
void hci\+\_\+decode\+\_\+received\+\_\+acl (\begin{DoxyParamCaption}\item[{uint16\+\_\+t \texorpdfstring{$\ast$}{*}}]{handle}{, }\item[{hci\+\_\+acl\+\_\+packet\+\_\+boundary\+\_\+flag\+\_\+t \texorpdfstring{$\ast$}{*}}]{pb}{, }\item[{hci\+\_\+acl\+\_\+packet\+\_\+broadcast\+\_\+flag\+\_\+t \texorpdfstring{$\ast$}{*}}]{bc}{, }\item[{uint16\+\_\+t \texorpdfstring{$\ast$}{*}}]{length}{, }\item[{const \mbox{\hyperlink{structhci__acl__packet__t}{hci\+\_\+acl\+\_\+packet\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{acl\+\_\+buffer}{}\end{DoxyParamCaption})}



Decodes a received ACL packet. 

Like send, gets back the packet boundary, broadcast flags, and more.


\begin{DoxyParams}{Parameters}
{\em handle} & Bluetooth Connection Handle In. Not NULL! \\
\hline
{\em pb} & Packet boundary Flag In. Not NULL! \\
\hline
{\em bc} & Broadcast boundary Flag In. Not NULL! \\
\hline
{\em length} & Length of data received. Not NULL!\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_aa306fd34fe4e74c3bf54b10403c088c6}\index{hci.c@{hci.c}!hci\_get\_remote\_name@{hci\_get\_remote\_name}}
\index{hci\_get\_remote\_name@{hci\_get\_remote\_name}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_get\_remote\_name()}{hci\_get\_remote\_name()}}
{\footnotesize\ttfamily \label{hci_8c_aa306fd34fe4e74c3bf54b10403c088c6} 
int hci\+\_\+get\+\_\+remote\+\_\+name (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structhci__discovered__device__info__t}{hci\+\_\+discovered\+\_\+device\+\_\+info\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{device}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{name}{}\end{DoxyParamCaption})}



Returns the remote name of a device. 

Useful for for device detection and enumeration.

IMPORTANT\+: You can\textquotesingle{}t call this during an inquiry, you must wait for it to end.


\begin{DoxyParams}{Parameters}
{\em device} & Device information to poll. \\
\hline
{\em name} & Name output, must be HCI\+\_\+\+MAX\+\_\+\+NAME\+\_\+\+REQUEST\+\_\+\+LENGTH in size.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_a9060d7f439b8630abb1c8b77d910ba25}\index{hci.c@{hci.c}!hci\_initialize@{hci\_initialize}}
\index{hci\_initialize@{hci\_initialize}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_initialize()}{hci\_initialize()}}
{\footnotesize\ttfamily \label{hci_8c_a9060d7f439b8630abb1c8b77d910ba25} 
int hci\+\_\+initialize (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{device}{}\end{DoxyParamCaption})}



Initializes the HCI interface. 

Initializes the HCI driver opening the USB interface in IOS.


\begin{DoxyParams}{Parameters}
{\em device} & Device path to the USB device. For the wii\textquotesingle{}s built in its "{}/dev/usb/oh1/57e/305"{}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_af3918df454b0d3aef8f99722f056f5f9}\index{hci.c@{hci.c}!hci\_receive\_acl\_async@{hci\_receive\_acl\_async}}
\index{hci\_receive\_acl\_async@{hci\_receive\_acl\_async}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_receive\_acl\_async()}{hci\_receive\_acl\_async()}}
{\footnotesize\ttfamily \label{hci_8c_af3918df454b0d3aef8f99722f056f5f9} 
int hci\+\_\+receive\+\_\+acl\+\_\+async (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structhci__acl__packet__t}{hci\+\_\+acl\+\_\+packet\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{acl\+\_\+buffer}{, }\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{ipc\+\_\+buffer}{, }\item[{ipc\+\_\+async\+\_\+handler\+\_\+t}]{handler}{, }\item[{void \texorpdfstring{$\ast$}{*}}]{params}{}\end{DoxyParamCaption})}



Receives a ACL Packet Asynchronously. 

Unlike send, this is done asynchronously, and returns early, so that you can double buffer and make sure to never miss an ACL packet. Multiplexing / Reassembly / Channels are handled by L2\+CAP that makes these

These parameters will be set into hci\+\_\+acl\+\_\+packet\+\_\+in. Your data and length is available in there.

Also must be provided is a buffer size HCI\+\_\+\+ACL\+\_\+\+RECEIVE\+\_\+\+IPC\+\_\+\+BUFFER\+\_\+\+SIZE for storing the IPC data. So that it can store the message in the mean time until the callback is called.


\begin{DoxyParams}{Parameters}
{\em buffer} & ACL packet buffer to receive into. \\
\hline
{\em ipc\+\_\+buffer} & Data buffer for the IPC data. Needs to be kept around until the callback is called. Needs to be 32 byte aligned. \\
\hline
{\em handler} & Called when data is received \\
\hline
{\em params} & Pointer passed to handler\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_a03b5e03bc25d2bc2cb6a24397be097c3}\index{hci.c@{hci.c}!hci\_reset@{hci\_reset}}
\index{hci\_reset@{hci\_reset}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_reset()}{hci\_reset()}}
{\footnotesize\ttfamily \label{hci_8c_a03b5e03bc25d2bc2cb6a24397be097c3} 
int hci\+\_\+reset (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Resets the HCI Interface. 

Its recommended to do this to get it into a known state. \begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
\Hypertarget{hci_8c_a0237e9b843f7a2506862f0cd31f48133}\index{hci.c@{hci.c}!hci\_send\_acl@{hci\_send\_acl}}
\index{hci\_send\_acl@{hci\_send\_acl}!hci.c@{hci.c}}
\doxysubsubsection{\texorpdfstring{hci\_send\_acl()}{hci\_send\_acl()}}
{\footnotesize\ttfamily \label{hci_8c_a0237e9b843f7a2506862f0cd31f48133} 
int hci\+\_\+send\+\_\+acl (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{handle}{, }\item[{hci\+\_\+acl\+\_\+packet\+\_\+boundary\+\_\+flag\+\_\+t}]{pb}{, }\item[{hci\+\_\+acl\+\_\+packet\+\_\+broadcast\+\_\+flag\+\_\+t}]{bc}{, }\item[{uint16\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Sends a ACL Packet. 

These are the asynchronous data packets that are sent to devices. Multiplexing / Reassembly / Channels are handled by L2\+CAP that makes these

These parameters will be set into hci\+\_\+acl\+\_\+packet\+\_\+out, you must fill in the data though.


\begin{DoxyParams}{Parameters}
{\em handle} & Bluetooth Connection Handle From hci\+\_\+create\+\_\+connection \\
\hline
{\em pb} & Packet boundary flag. \\
\hline
{\em bc} & Broadcast boundary flag. \\
\hline
{\em length} & Length of data transmitted.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Negative if Error 
\end{DoxyReturn}
